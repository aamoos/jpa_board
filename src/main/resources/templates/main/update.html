<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout/default_layout">

  <th:block layout:fragment="content">
    <input type="hidden" id="boardIdx" th:value="${board.boardIdx}" />
    <input type="hidden" id="regDate" th:value="${board.regDate}" />
    <article>
      <div class="container" role="main">
        <h2>게시판 상세</h2>
        <form name="form" id="form" role="form" method="post" action="${pageContext.request.contextPath}/board/saveBoard">
          <div class="mb-3">
            <label for="boardTitle">제목</label>
            <input type="text" class="form-control" id="boardTitle" name="boardTitle" placeholder="제목을 입력해 주세요" th:value="${board.boardTitle}" >
          </div>

          <div class="mb-3">
            <label for="regId">작성자</label>
            <input type="text" class="form-control" id="regId" name="regId"  th:value="${board.regId}" readonly>
          </div>


          <div class="mb-3">
            <label for="boardContent">내용</label>
            <textarea class="form-control" rows="5" id="boardContent" name="boardContent" placeholder="내용을 입력해 주세요" th:text="${board.boardContent}"></textarea>
          </div>

        </form>

        <br>
          <div>
            <button th:if="${session.authority == 'ADMIN'}" onclick="updateSubmit()" type="button" class="btn btn-sm btn-primary" id="btnSave">수정</button>
            <button th:if="${session.authority == 'ADMIN'}" onclick="boardDelete()" type="button" class="btn btn-sm btn-danger" >삭제</button>
            <button onclick="location.href='/'" type="button" class="btn btn-sm btn-primary" id="btnList">목록</button>
          </div>
      </div>
    </article>
  </th:block>
</html>

<script th:inline="javascript">

	//수정 버튼
	function updateSubmit(){

		var params = {
			 boardTitle : $.trim($("#boardTitle").val())
			,boardContent : $.trim($("#boardContent").val())
			,regId : $("#loginId").val()
			,boardIdx : $("#boardIdx").val()
			,useYn : "Y"
			,regDate : $("#regDate").val()
		}

		console.log(params);

		if(params.boardTitle == ""){
			alert("제목을 입력해주세요.");
			return false;
		}

		else if(params.boardContent == ""){
			alert("내용을 입력해주세요.");
			return false;
		}

		$.ajax({
	         type : 'POST'
	        ,url : "/board/update"
	        ,dataType : 'json'
	        ,data : JSON.stringify(params)
	        ,contentType: 'application/json'
	        ,success : function(result) {
				alert("해당글이 정상적으로 수정되었습니다.");
				location.href= "/";
	        },
	        error: function(request, status, error) {

	        }
	    })
	}
	//게시판 삭제하기
	function boardDelete(){

		var boardIdxArray = [];

		boardIdxArray.push($("#boardIdx").val());

		console.log(boardIdxArray);

		if(boardIdxArray == ""){
			alert("삭제할 항목을 선택해주세요.");
			return false;
		}

		var confirmAlert = confirm('정말로 삭제하시겠습니까?');
		if(confirmAlert){

			$.ajax({
		        type : 'POST'
		       ,url : "/board/delete"
		       ,dataType : 'json'
		       ,data : JSON.stringify(boardIdxArray)
		       ,contentType: 'application/json'
		       ,success : function(result) {
					alert("해당글이 정상적으로 삭제되었습니다.");
					location.href = "/";
		       },
		       error: function(request, status, error) {

		       }
		   })
		}
	}


</script>